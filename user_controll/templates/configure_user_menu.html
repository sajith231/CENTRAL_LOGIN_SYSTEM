{% extends "base.html" %}
{% load static %}

{% block title %}Configure Menu{% endblock %}
{% block header_title %}<strong>User Menu Control</strong><span class="muted"> / configure</span>{% endblock %}
{% block active_user_menu_control %}active{% endblock %}

{% block content %}
  {% if messages %}
    {% for message in messages %}
      <div class="card" style="margin-bottom:12px;">{{ message }}</div>
    {% endfor %}
  {% endif %}

  <div class="card">
    <h2 style="margin-top:0; color:white;">
      Configure Menus for {{ u.name }}
      <span class="muted" style="font-size:14px;">({{ u.email }})</span>
    </h2>

    <form method="post">
      {% csrf_token %}

      {% for m in menus %}
        {# show whole main menu only if at least one submenu is allowed OR we are configuring; in configure page we show all #}
        <div style="margin-top:16px; padding:12px; border-radius:10px; background:#020617;">
          <div style="font-weight:600; margin-bottom:8px;">
            <i class="{{ m.icon }}"></i> {{ m.name }}
          </div>

          <div style="display:flex; flex-wrap:wrap; gap:10px;">
            {% for s in m.submenus %}
              <label style="display:flex; align-items:center; gap:6px; background:#0b1220; padding:8px 10px; border-radius:8px; font-size:14px;">
                <input
                  type="checkbox"
                  name="menu_{{ s.id }}"
                  value="1"
                  {% if s.id in allowed %}checked{% endif %}
                  style="accent-color:#2563eb;"
                >
                <i class="{{ s.icon }}"></i> {{ s.name }}
                <span class="muted" style="font-size:11px;">[{{ s.id }}]</span>
              </label>
            {% endfor %}
          </div>
        </div>
      {% endfor %}

      <div style="margin-top:18px;">
        <button type="submit" class="btn" style="background:#16a34a; color:white; padding:10px 18px; border-radius:8px;">
          Save Menus
        </button>
        <a href="{% url 'user_controll:user_menu_user_list' %}" class="btn" style="margin-left:6px; color:white;">
          Cancel
        </a>
      </div>
    </form>
  </div>
{% endblock %}
