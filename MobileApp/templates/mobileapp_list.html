{% extends "base.html" %}
{% load static %}

{% block active_mobile_app_list %}active{% endblock %}
{% block header_title %}<strong>Mobile App List</strong>{% endblock %}

{% block content %}
<div class="card">
  <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;">
    <h2 style="margin:0; font-size:20px;">Mobile App Projects</h2>

    <a href="{% url 'MobileApp:mobileproject_create' %}" class="btn">
      <i class="fa-solid fa-plus"></i> Add New
    </a>
  </div>

  {% if messages %}
    {% for message in messages %}
      <div style="background:#1e293b; padding:12px; border-radius:10px; margin-bottom:10px;">
        {{ message }}
      </div>
    {% endfor %}
  {% endif %}

  {% if projects %}
    <div style="overflow-x:auto;">
      <table style="width:100%; border-collapse:collapse;">
        <thead>
          <tr style="background:#1e293b;">
            <th style="padding:12px; text-align:left;">No</th>
            <th style="padding:12px; text-align:left;">Created Date</th>
            <th style="padding:12px; text-align:left;">Project Name</th>
            <th style="padding:12px; text-align:center;">Description</th>
            <th style="padding:12px; text-align:left;">Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for project in projects %}
            <tr style="border-bottom:1px solid #1e293b;">
              <td style="padding:12px;">{{ forloop.counter }}</td>
              <td style="padding:12px;">{{ project.created_date|date:"d/m/Y" }}</td>
              <td style="padding:12px;"><strong>{{ project.project_name }}</strong></td>
              <td style="padding:12px; text-align:center;">
                {% if project.description %}
                  <button class="btn" data-bs-toggle="modal" data-bs-target="#descModal{{ project.id }}">
                    <i class="fa-solid fa-file-lines"></i>
                  </button>
                {% else %}
                  <span style="color:#9ca3af;">-</span>
                {% endif %}
              </td>
              <td style="padding:12px;">
                <a href="{% url 'MobileApp:mobileproject_edit' project.id %}" class="btn">
                  <i class="fa-solid fa-pen-to-square"></i> Edit
                </a>
                <button class="btn" style="background:#7f1d1d;"
                        data-bs-toggle="modal" data-bs-target="#deleteModal{{ project.id }}">
                  <i class="fa-solid fa-trash"></i> Delete
                </button>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <p style="margin-top:16px; color:#9ca3af;">
      Total Projects: {{ projects.count }}
    </p>

  {% else %}
    <div style="padding:40px; text-align:center;">
      <i class="fa-solid fa-circle-info" style="font-size:40px; margin-bottom:10px;"></i>
      <h3>No mobile projects found</h3>
      <p>Add your first project using the button above.</p>
    </div>
  {% endif %}
</div>

<!-- Modals -->
{% for project in projects %}
  {% if project.description %}
  <div class="modal fade" id="descModal{{ project.id }}" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content" style="background:#1e293b; color:white;">
        <div class="modal-header" style="border-bottom:1px solid #334155;">
          <h5 class="modal-title">Description - {{ project.project_name }}</h5>
          <button class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          {{ project.description|linebreaks }}
        </div>
        <div class="modal-footer" style="border-top:1px solid #334155;">
          <button class="btn" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
  {% endif %}

  <div class="modal fade" id="deleteModal{{ project.id }}" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content" style="background:#1e293b; color:white;">
        <div class="modal-header" style="border-bottom:1px solid #334155;">
          <h5 class="modal-title"><i class="fa-solid fa-triangle-exclamation"></i> Confirm Delete</h5>
          <button class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <p>Are you sure you want to delete:</p>
          <h4 class="text-center">{{ project.project_name }}</h4>
          <div style="margin-top:10px; background:#7f1d1d; padding:12px; border-radius:8px;">
            This action cannot be undone.
          </div>
        </div>
        <div class="modal-footer" style="border-top:1px solid #334155;">
          <button class="btn" data-bs-dismiss="modal">Cancel</button>
          <a href="{% url 'MobileApp:mobileproject_delete' project.id %}" class="btn" style="background:#b91c1c;">
            Yes, Delete
          </a>
        </div>
      </div>
    </div>
  </div>
{% endfor %}
{% endblock %}
