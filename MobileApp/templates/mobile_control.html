{% extends "base.html" %}
{% load static %}

{% block active_mobile_control %}active{% endblock %}
{% block header_title %}<strong>Mobile Control</strong>{% endblock %}

{% block content %}
<div class="card">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;">
        <h2 style="margin:0; font-size:20px;">Mobile Control</h2>

        <!-- The button you requested named "Control" that goes to add page -->
        <a href="{% url 'MobileApp:add_mobile_control' %}" class="btn">
            <i class="fa-solid fa-sliders"></i> Control
        </a>
    </div>

    {% if messages %}
        {% for message in messages %}
            <div style="background:#1e293b; padding:12px; border-radius:10px; margin-bottom:10px;">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}

    {% if controls %}
    <div style="overflow-x:auto;">
        <table style="width:100%; border-collapse:collapse;">
            <thead>
                <tr style="background:#1e293b;">
                    <th style="padding:12px; text-align:left;">No</th>
                    <th style="padding:12px; text-align:left;">Created</th>
                    <th style="padding:12px; text-align:left;">Project</th>
                    <th style="padding:12px; text-align:left;">Customer</th>
                    <th style="padding:12px; text-align:left;">Client ID</th>
                    <th style="padding:12px; text-align:center;">Login Limit</th>
                    <th style="padding:12px; text-align:left;">Actions</th>
                </tr>
            </thead>

            <tbody>
                {% for c in controls %}
                <tr style="border-bottom:1px solid #1e293b;">
                    <td style="padding:12px;">{{ forloop.counter }}</td>
                    <td style="padding:12px;">{{ c.created_date|date:"d/m/Y H:i" }}</td>
                    <td style="padding:12px;"><strong>{{ c.project.project_name }}</strong></td>
                    <td style="padding:12px;">{{ c.customer_name }}</td>
                    <td style="padding:12px;">{{ c.client_id }}</td>
                    <td style="padding:12px; text-align:center;">{{ c.login_limit }}</td>
                    <td style="padding:12px;">
                        <a href="{% url 'MobileApp:edit_mobile_control' c.id %}" class="btn">
                            <i class="fa-solid fa-pen-to-square"></i> Edit
                        </a>

                        <button class="btn" style="background:#7f1d1d;"
                                data-bs-toggle="modal" data-bs-target="#deleteModal{{ c.id }}">
                            <i class="fa-solid fa-trash"></i> Delete
                        </button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <p style="margin-top:16px; color:#9ca3af;">
        Total Controls: {{ controls.count }}
    </p>

    {% else %}
    <div style="padding:40px; text-align:center;">
        <i class="fa-solid fa-circle-info" style="font-size:40px; margin-bottom:10px;"></i>
        <h3>No controls found</h3>
        <p>Add one via the Control button above.</p>
    </div>
    {% endif %}
</div>

<!-- Delete modals -->
{% for c in controls %}
<div class="modal fade" id="deleteModal{{ c.id }}" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content" style="background:#1e293b; color:white;">
            <div class="modal-header" style="border-bottom:1px solid #334155;">
                <h5 class="modal-title">Confirm Delete</h5>
                <button class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete:</p>
                <h4 class="text-center">{{ c.customer_name }} â€” {{ c.project.project_name }}</h4>
            </div>
            <div class="modal-footer" style="border-top:1px solid #334155;">
                <button class="btn" data-bs-dismiss="modal">Cancel</button>
                <a href="{% url 'MobileApp:delete_mobile_control' c.id %}" class="btn" style="background:#b91c1c;">
                    Yes, Delete
                </a>
            </div>
        </div>
    </div>
</div>
{% endfor %}

{% endblock %}

