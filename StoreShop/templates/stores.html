{% extends 'base.html' %}
{% block title %}Stores{% endblock %}
{% block header_title %}<strong>Stores</strong><span class="muted"> / list</span>{% endblock %}
{% block active_store %}active{% endblock %}

{% block content %}
<div class="card" style="padding:0;">
  <div style="display:flex; justify-content:space-between; align-items:center;
              padding:16px 20px; border-bottom:1px solid rgba(255,255,255,.06);">
    <h2 style="margin:0;">Corporate</h2>
    <a href="{% url 'add_store' %}" class="btn btn-success">Add New</a>
  </div>

  <!-- ðŸ” Search Filter -->
  <div style="padding:12px 20px;">
    <input type="text" id="storeSearch" placeholder="Search store..." style="padding:8px 12px; width:250px; border-radius:6px;
                    border:1px solid #334155; background:#0f1b31; color:white;">
    <select id="branchFilter"
        style="padding:8px 12px;
              margin-left:10px;
              border-radius:6px;
              border:1px solid #334155;
              background:#0f1b31;
              color:white;">
              
        <option value="">All Branches</option>

        {% for branch in branches %}
            <option value="{{ branch.name }}">
                {{ branch.name }}
            </option>
        {% endfor %}
    </select>

  </div>

  <script>
    function filterStores() {
      let keyword = document.getElementById("storeSearch").value.toLowerCase();
      let selectedBranch = document.getElementById("branchFilter").value.toLowerCase();
      let rows = document.querySelectorAll("table tbody tr");

      rows.forEach(row => {
        let name = row.querySelector("td:nth-child(5)").innerText.toLowerCase();
        let branch = row.querySelector("td:nth-child(6)").innerText.toLowerCase();
        let nameMatch = name.includes(keyword);
        let branchMatch = selectedBranch === "" || branch === selectedBranch;
        row.style.display = nameMatch && branchMatch ? "" : "none";
      });
    }

    document.getElementById("storeSearch").addEventListener("keyup", filterStores);
    document.getElementById("branchFilter").addEventListener("change", filterStores);
  </script>

  <div style="padding:0 20px 20px;">
    <div style="overflow: scroll;">
      <table style="width:100%; border-collapse:separate; border-spacing:0 8px;">
        <thead>
          <tr style="background: var(--hover);">
            <th style="padding:12px;">#</th>
            <th style="padding:12px;">Created Date</th>
            <th style="padding:12px;">Created By</th>
            <th style="padding:12px;">Corporate ID</th>
            <th style="padding:12px;">Corporate Name</th>
            <th style="padding:12px;">Branch</th>
            <th style="padding:12px;">Place</th>
            <th style="padding:12px;">Edit</th>
            <th style="padding:12px;">Delete</th>
          </tr>
        </thead>
        <tbody>
          {% for store in stores %}
          <tr style="background:#0f1b31;">
            <td style="padding:12px;">{{ forloop.counter }}</td>
            <td style="padding:12px;">{{ store.created_at|date:"d-m-Y" }} <br> <span
                style="font-size: 11px; color:#888;">{{ store.created_at|date:"h:i A" }}</span></td>
            <td style="padding:12px;">{{ store.created_by.username|default:"-" }}</td>
            <td style="padding:12px;">{{ store.store_id }}</td>
            <td style="padding:12px;">{{ store.name }}</td>
            <td style="padding:12px;">{{ store.branch.name }}</td>
            <td style="padding:12px;">{{ store.place }}</td>
            <td style="padding:12px;">
              <a href="{% url 'edit_store' store.id %}" class="btn btn-primary btn-sm">Edit</a>
            </td>
            <td style="padding:12px;">
              <form method="post" action="{% url 'delete_store' store.id %}"
                onsubmit="return confirm('Are you sure?');">
                {% csrf_token %}
                <button type="submit" class="btn btn-danger btn-sm">Delete</button>
              </form>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="7" style="padding:12px;">No stores yet.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}